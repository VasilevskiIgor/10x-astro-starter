---
/**
 * Signup Page
 *
 * User registration page using Supabase Auth.
 * Features:
 * - Server-side session check (redirect if logged in)
 * - Support for redirect parameter
 * - Email/Password registration form
 * - i18n support
 */

import Layout from "@/layouts/Layout.astro";
import { SignupForm } from "@/components/forms/SignupForm";

// Get redirect URL from query params
let redirectTo = "/trips";
try {
  const url = new URL(Astro.request.url);
  redirectTo = url.searchParams.get("redirect") || "/trips";
} catch (error) {
  console.error("[signup.astro] Error parsing URL:", error);
}
---

<Layout title="Utwórz konto - Magic Travel App">
  <main
    class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-blue-50 flex items-center justify-center px-4 py-12 sm:px-6 lg:px-8"
  >
    <div class="w-full max-w-md">
      {/* Header */}
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900" data-i18n="auth.signup_title">Utwórz konto</h1>
        <p class="mt-2 text-sm text-gray-600" data-i18n="auth.signup_subtitle">
          Zacznij planować swoje wymarzone podróże
        </p>
      </div>

      {/* Signup Form Card */}
      <div class="bg-white rounded-lg shadow-xl p-8 border border-gray-200">
        <SignupForm client:load redirectTo={redirectTo} />
      </div>

      {/* Footer Links */}
      <div class="mt-6 text-center">
        <p class="text-sm text-gray-600">
          <span data-i18n="auth.have_account">Masz już konto?</span>{" "}
          <a
            href={redirectTo !== "/trips" ? `/auth/login?redirect=${redirectTo}` : "/auth/login"}
            class="text-blue-600 hover:text-blue-700 font-semibold transition-colors"
            data-i18n="auth.login_link"
          >
            Zaloguj się
          </a>
        </p>
      </div>

      <div class="mt-4 text-center">
        <a href="/" class="text-sm text-gray-500 hover:text-gray-700 transition-colors" data-i18n="auth.back_to_home">
          ← Wróć do strony głównej
        </a>
      </div>
    </div>
  </main>

  <script>
    import { t, getLocaleFromStorage } from "@/i18n";
    import type { TranslationKey } from "@/i18n";

    const locale = getLocaleFromStorage();

    // Translate all elements with data-i18n attribute
    document.querySelectorAll("[data-i18n]").forEach((element) => {
      const key = element.getAttribute("data-i18n");
      if (key) {
        element.textContent = t(key as TranslationKey, locale);
      }
    });
  </script>
</Layout>
